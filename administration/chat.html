<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat</title>
    <style>
        #chat {
            height: 300px;
            border: 1px solid #ccc;
            overflow-y: auto;
            padding: 5px;
            margin-bottom: 10px;
            font-family: sans-serif;
        }
    </style>
</head>
<body>

<h2>üí¨ –ß–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h2>
<div id="chat"></div>
<input type="text" id="msg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
<button onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

<script>
    const ws = new WebSocket('ws://localhost:8080');

    ws.onopen = () => {
        console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    };

    ws.onerror = err => {
        console.error('‚ùå –û—à–∏–±–∫–∞ WebSocket:', err);
    };

    ws.onclose = () => {
        console.warn('‚ö†Ô∏è –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
    };

    ws.onmessage = async e => {
        let text = '';
        if (e.data instanceof Blob) {
            text = await e.data.text();
        } else {
            text = e.data;
        }
        document.getElementById('chat').innerHTML += `<div>${text}</div>`;
        const chatBox = document.getElementById('chat');
        chatBox.scrollTop = chatBox.scrollHeight;
    };

    function send() {
        const input = document.getElementById('msg');
        const message = input.value.trim();
        if (!message) return;
        if (ws.readyState === WebSocket.OPEN) {
            ws.send(message);
            input.value = '';
        } else {
            alert('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        }
    }
</script>

</body>
</html>
